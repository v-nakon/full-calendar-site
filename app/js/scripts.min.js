document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let a=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),a.unobserve(t)}}))}));e.forEach((function(e){a.observe(e)}));let c=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),c.unobserve(e.target))}))}));t.forEach((function(e){c.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}}))}));n.forEach((function(e){o.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))}));import{addOptionSelect}from"./helpers/help_create_elements.js";import{getCategories}from"./helpers/requests.js";import{getCities}from"./helpers/requests.js";import{getSubjects}from"./helpers/requests.js";import{addCatToSearch}from"./helpers/category_search_block.js";import{delActiveColor}from"./helpers/help_create_elements.js";var calendar;getAllEvents(),getCitiesData(),getCategoriesData(),getSubjectsData();let btnSearch=document.getElementById("btn_search");btnSearch.addEventListener("click",()=>searchTitleCity("event_name","location","subject_search"));var modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));var elSpinner=document.querySelector(".container_spinner");function getAllEvents(){axios.get("https://eventafisha.com/api/v1/events").then((function(e){let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))})).catch((function(e){console.log(e)})).then((function(){}))}function getCitiesData(){getCities().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"location")}).catch(e=>{console.log(e)})}function getSubjectsData(){getSubjects().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"subject_search")}).catch(e=>{console.log(e)})}function getCategoriesData(){getCategories().then(e=>{for(let t in e.data)addCatToSearch(e.data[t],".container_category")}).catch(e=>{console.log(e)})}export var nameEventSearch="";export var cityEventSearch="";export var categorySearch="";export var subjectSearch="";export function setCategorySearch(e){categorySearch=e}function checkSearchParam(e,t,n,a,c){let o="https://eventafisha.com/api/v1/events?";return""!==e&&(o+="&title="+e),""!==t&&(o+="&city_id="+t),""!==n&&(o+="&date="+n),""!==a&&(o+="&category_id="+a),""!==c&&(o+="&subject_id="+c),o}export function searchRequest(e,t,n,a){calendar.destroy(),elSpinner.classList.remove("hide_spinner");let c=checkSearchParam(e,t,"",n,a);axios.get(c).then((function(e){let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))})).catch((function(e){console.log(e)}))}function searchTitleCity(e,t,n){nameEventSearch=document.getElementById(e).value,cityEventSearch=document.getElementById(t).value,subjectSearch=document.getElementById(n).value,searchRequest(nameEventSearch,cityEventSearch,categorySearch,subjectSearch)}function sliceText(e){let t=e.replace(/<\/?[^>]+>/g,"");return t=t.slice(0,100),t.length<e.length&&(t+="..."),t}function createEvents(e){let t=[];for(let n in e){let a={};a.title=e[n].title,a.start=e[n].start_date,a.color="purple",a.url="/event-page.html?id="+e[n].id,a.description='<a href="/event-page.html?id='+e[n].id+'"><img src="https://eventafisha.com/storage/'+e[n].images+'" width="150">\n\t\t<h1>'+e[n].title+'</h1>\n\t\t<div class="desc_short">'+sliceText(e[n].desc)+"</div> </a>",t.push(a)}createCalendar(t)}function createCalendar(e){var t=document.getElementById("calendar");t.innerHTML="",(calendar=new FullCalendar.Calendar(t,{plugins:["dayGrid"],defaultView:"dayGridMonth",themeSystem:"solar",height:"parent",locale:"ru",eventRender:function(e){e.el.onmouseover=function(t){e.el.style.opacity="0.5"},e.el.onmouseout=function(t){e.el.style.opacity="1"};new Tooltip(e.el,{title:e.event.extendedProps.description,placement:"top",trigger:"hover",container:"body",html:!0})},events:e,eventTextColor:"white"})).render()}var searchIcon=document.getElementById("search_icon"),containerSearch=document.querySelector(".container_search"),containerLogo=document.querySelector(".container_logo");searchIcon.addEventListener("click",(function(){containerSearch.classList.contains("show")?(containerSearch.classList.remove("show"),containerLogo.classList.remove("hide")):(containerSearch.classList.add("show"),containerLogo.classList.add("hide"))}));