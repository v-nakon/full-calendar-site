document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),a=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let n=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),n.unobserve(t)}}))}));e.forEach((function(e){n.observe(e)}));let r=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),r.unobserve(e.target))}))}));t.forEach((function(e){r.observe(e)}));let c=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",c.unobserve(t)}}))}));a.forEach((function(e){c.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),a.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))}));import{addOptionSelect}from"./helpers/help_create_elements.js";import{getCategories}from"./helpers/requests.js";import{getCities}from"./helpers/requests.js";import{getSubjects}from"./helpers/requests.js";import{getAllEvents}from"./helpers/requests.js";import{searchEvents}from"./helpers/requests.js";import{addCatToSearch}from"./helpers/category_search_block.js";import{delActiveColor}from"./helpers/help_create_elements.js";var calendar;getCitiesData(),getCategoriesData(),getSubjectsData();let btnSearch=document.getElementById("btn_search");btnSearch.addEventListener("click",()=>searchEvent("event_name","location","subject_search"));var modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));var elSpinner=document.querySelector(".container_spinner");function getAllEventsData(){getAllEvents().then(e=>{let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))}).catch(e=>{console.log(e)})}function getCitiesData(){getCities().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"location")}).catch(e=>{console.log(e)})}function getSubjectsData(){getSubjects().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"subject_search")}).catch(e=>{console.log(e)})}function getCategoriesData(){getCategories().then(e=>{for(let t in e.data)addCatToSearch(e.data[t],".container_category")}).catch(e=>{console.log(e)})}export var nameEventSearch="";export var cityEventSearch="";export var categorySearch="";export var subjectSearch="";export function setCategorySearch(e){categorySearch=e}function checkSearchParam(e,t,a,n,r){let c="https://eventafisha.com/api/v1/events?";return""!==e&&(c+="&title="+e),""!==t&&(c+="&city_id="+t),""!==a&&(c+="&date="+a),""!==n&&(c+="&category_id="+n),""!==r&&(c+="&subject_id="+r),c}export function searchRequest(e,t,a,n){elSpinner.classList.remove("hide_spinner"),searchEventsData(checkSearchParam(e,t,"",a,n))}function searchEventsData(e){searchEvents(e).then(e=>{let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))}).catch(e=>{console.log(e)})}function searchEvent(e,t,a,n){nameEventSearch=document.getElementById(e).value,cityEventSearch=void 0===n?document.getElementById(t).value:n,subjectSearch=document.getElementById(a).value,searchRequest(nameEventSearch,cityEventSearch,categorySearch,subjectSearch)}function sliceText(e){let t=e.replace(/<\/?[^>]+>/g,"");return t=t.slice(0,100),t.length<e.length&&(t+="..."),t}function createEvents(e){let t=[];for(let a in e){let n={};n.title=e[a].title,n.start=e[a].start_date,n.color="purple",n.url="/event-page.html?id="+e[a].id,n.description='<a href="/event-page.html?id='+e[a].id+'"><img src="https://eventafisha.com/storage/'+e[a].images+'" width="150">\n\t\t<h1>'+e[a].title+'</h1>\n\t\t<div class="desc_short">'+sliceText(e[a].desc)+"</div> </a>",t.push(n)}createCalendar(t)}function createCalendar(e){var t=document.getElementById("calendar");t.innerHTML="",(calendar=new FullCalendar.Calendar(t,{plugins:["dayGrid"],defaultView:"dayGridMonth",themeSystem:"solar",height:"parent",locale:"ru",eventRender:function(e){e.el.onmouseover=function(t){e.el.style.opacity="0.5"},e.el.onmouseout=function(t){e.el.style.opacity="1"};new Tooltip(e.el,{title:e.event.extendedProps.description,placement:"top",trigger:"hover",container:"body",html:!0})},events:e,eventTextColor:"white"})).render()}var searchIcon=document.getElementById("search_icon"),containerSearch=document.querySelector(".container_search"),containerLogo=document.querySelector(".container_logo");function pushEnterBtn(e){if(13==e.which||13==e.keyCode){let e=document.activeElement.tagName;"INPUT"!==e&&"SELECT"!==e||searchRequest(nameEventSearch,cityEventSearch,categorySearch,subjectSearch)}}searchIcon.addEventListener("click",(function(){containerSearch.classList.contains("show")?(containerSearch.classList.remove("show"),containerLogo.classList.remove("hide")):(containerSearch.classList.add("show"),containerLogo.classList.add("hide"))})),document.addEventListener("keydown",pushEnterBtn);let urlStringParams=window.location.search,urlParams=new URLSearchParams(urlStringParams),categoryIdParam=urlParams.get("cat_id"),cityIdParam=urlParams.get("city_id");console.log(cityIdParam),null!==categoryIdParam?(categorySearch=categoryIdParam,searchEvent("event_name","location","subject_search")):null!==cityIdParam?searchEvent("event_name","location","subject_search",cityIdParam):getAllEventsData();