document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let c=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),c.unobserve(t)}}))}));e.forEach((function(e){c.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),o.unobserve(e.target))}))}));t.forEach((function(e){o.observe(e)}));let a=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",a.unobserve(t)}}))}));n.forEach((function(e){a.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))})),getAllEvents(),getCities("location");let btnSearch=document.getElementById("btn_search");function getAllEvents(){axios.get("https://eventafisha.com/api/v1/events").then((function(e){let t=e.data;console.log(e.data),createEvents(t)})).catch((function(e){console.log(e)})).then((function(){}))}function getCities(e){axios.get("https://eventafisha.com/api/v1/cities").then((function(t){for(let n in t.data)addOptionSelect(t.data[n],e)})).catch((function(e){console.log(e)})).then((function(){}))}function checkSearchParam(e,t,n,c){let o="https://eventafisha.com/api/v1/events?";return""!==e&&(o+="&title="+e),""!==t&&(o+="&city_id="+t),""!==n&&(o+="&date="+n),""!==c&&(o+="&category_id="+c),o}function searchRequest(e,t){let n=checkSearchParam(e,t,"","");console.log(n),axios.get(n,{params:{title:e,city_id:t}}).then((function(e){console.log(e),createEvents(e.data.data)})).catch((function(e){console.log(e)}))}function addOptionSelect(e,t){let n=document.getElementById(t),c=document.createElement("option");c.value=e.id,c.innerHTML=e.title,n.add(c)}function searchTitleCity(e,t){searchRequest(document.getElementById(e).value,document.getElementById(t).value)}function sliceText(e){let t=e.replace(/<\/?[^>]+>/g,"");return t=t.slice(0,100),t.length<e.length&&(t+="..."),t}function createEvents(e){let t=[];for(let n in e){let c={};c.title=e[n].title,c.start=e[n].start_date,c.color="purple",c.url="/event-page.html?id="+e[n].id,c.description='<img src="https://eventafisha.com/storage/'+e[n].images+'" width="150">\n\t\t<h1>'+e[n].title+'</h1>\n\t\t<div class="desc_short">'+sliceText(e[n].desc)+"</div>",t.push(c)}console.log(t),createCalendar(t)}function createCalendar(e){var t=document.getElementById("calendar");new FullCalendar.Calendar(t,{plugins:["dayGrid"],defaultView:"dayGridMonth",themeSystem:"solar",height:"parent",locale:"ru",eventRender:function(e){e.el.onmouseover=function(t){e.el.style.opacity="0.5"},e.el.onmouseout=function(t){e.el.style.opacity="1"};new Tooltip(e.el,{title:e.event.extendedProps.description,placement:"top",trigger:"hover",container:"body",html:!0})},events:e,eventTextColor:"white"}).render()}btnSearch.addEventListener("click",()=>searchTitleCity("event_name","location"));var searchIcon=document.getElementById("search_icon"),containerSearch=document.querySelector(".container_search"),containerLogo=document.querySelector(".container_logo");searchIcon.addEventListener("click",(function(){containerSearch.classList.contains("show")?(containerSearch.classList.remove("show"),containerLogo.classList.remove("hide")):(containerSearch.classList.add("show"),containerLogo.classList.add("hide"))}));