var calendar;document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let c=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),c.unobserve(t)}}))}));e.forEach((function(e){c.observe(e)}));let a=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),a.unobserve(e.target))}))}));t.forEach((function(e){a.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}}))}));n.forEach((function(e){o.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))})),getAllEvents(),getCities("location"),getCategories(),getSubjects();let btnSearch=document.getElementById("btn_search");btnSearch.addEventListener("click",()=>searchTitleCity("event_name","location","subject_search"));var modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));var elSpinner=document.querySelector(".container_spinner");function getAllEvents(){axios.get("https://eventafisha.com/api/v1/events").then((function(e){let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))})).catch((function(e){console.log(e)})).then((function(){}))}function getCities(e){axios.get("https://eventafisha.com/api/v1/cities").then((function(t){for(let n in t.data)addOptionSelect(t.data[n],e)})).catch((function(e){console.log(e)})).then((function(){}))}function getCategories(){axios.get("https://eventafisha.com/api/v1/categories").then((function(e){for(let t in e.data)addCatToSearch(e.data[t],".container_category")})).catch((function(e){console.log(e)})).then((function(){}))}function getSubjects(){axios.get("https://eventafisha.com/api/v1/subjects").then((function(e){for(let t in e.data)addOptionSelect(e.data[t],"subject_search")})).catch((function(e){console.log(e)})).then((function(){}))}function addCatToSearch(e,t){let n=document.querySelector(t),c=document.createElement("div");c.classList.add("item_category"),c.setAttribute("category_id",e.id),c.innerHTML=e.title,n.appendChild(c),addEventToElement(c,e.id)}function addEventToElement(e,t){e.addEventListener("click",(function(){delActiveColor(),e.classList.add("color_active_cat"),document.querySelector(".arrow_down").classList.add("color_active_cat"),searchRequest(nameEventSearch,cityEventSearch,categorySearch=t,subjectSearch)}))}function delActiveColor(){document.querySelectorAll(".color_active_cat").forEach((function(e){e.classList.remove("color_active_cat")}))}var nameEventSearch="",cityEventSearch="",categorySearch="",subjectSearch="",arrElCat=[{el:document.querySelector("#search_cat_all"),id:""},{el:document.querySelector("#search_cat_main1"),id:24},{el:document.querySelector("#search_cat_main2"),id:1},{el:document.querySelector("#search_cat_main3"),id:2}];function addListenerToArrEl(e){for(let t in e)e[t].el.addEventListener("click",(function(){delActiveColor(),e[t].el.classList.add("color_active_cat"),categorySearch=e[t].id,searchRequest(nameEventSearch,cityEventSearch,categorySearch,subjectSearch)}))}function checkSearchParam(e,t,n,c,a){let o="https://eventafisha.com/api/v1/events?";return""!==e&&(o+="&title="+e),""!==t&&(o+="&city_id="+t),""!==n&&(o+="&date="+n),""!==c&&(o+="&category_id="+c),""!==a&&(o+="&subject_id="+a),o}function searchRequest(e,t,n,c){calendar.destroy(),elSpinner.classList.remove("hide_spinner");let a=checkSearchParam(e,t,"",n,c);axios.get(a).then((function(e){let t=e.data;0===e.data.length?modalNotFound.style.display="block":(createEvents(t),elSpinner.classList.add("hide_spinner"))})).catch((function(e){console.log(e)}))}function addOptionSelect(e,t){let n=document.getElementById(t),c=document.createElement("option");c.value=e.id,c.innerHTML=e.title,n.add(c)}function searchTitleCity(e,t,n){nameEventSearch=document.getElementById(e).value,cityEventSearch=document.getElementById(t).value,subjectSearch=document.getElementById(n).value,searchRequest(nameEventSearch,cityEventSearch,categorySearch,subjectSearch)}function sliceText(e){let t=e.replace(/<\/?[^>]+>/g,"");return t=t.slice(0,100),t.length<e.length&&(t+="..."),t}function createEvents(e){let t=[];for(let n in e){let c={};c.title=e[n].title,c.start=e[n].start_date,c.color="purple",c.url="/event-page.html?id="+e[n].id,c.description='<a href="/event-page.html?id='+e[n].id+'"><img src="https://eventafisha.com/storage/'+e[n].images+'" width="150">\n\t\t<h1>'+e[n].title+'</h1>\n\t\t<div class="desc_short">'+sliceText(e[n].desc)+"</div> </a>",t.push(c)}createCalendar(t)}function createCalendar(e){var t=document.getElementById("calendar");t.innerHTML="",(calendar=new FullCalendar.Calendar(t,{plugins:["dayGrid"],defaultView:"dayGridMonth",themeSystem:"solar",height:"parent",locale:"ru",eventRender:function(e){e.el.onmouseover=function(t){e.el.style.opacity="0.5"},e.el.onmouseout=function(t){e.el.style.opacity="1"};new Tooltip(e.el,{title:e.event.extendedProps.description,placement:"top",trigger:"hover",container:"body",html:!0})},events:e,eventTextColor:"white"})).render()}addListenerToArrEl(arrElCat);var searchIcon=document.getElementById("search_icon"),containerSearch=document.querySelector(".container_search"),containerLogo=document.querySelector(".container_logo");searchIcon.addEventListener("click",(function(){containerSearch.classList.contains("show")?(containerSearch.classList.remove("show"),containerLogo.classList.remove("hide")):(containerSearch.classList.add("show"),containerLogo.classList.add("hide"))}));var catWindow=document.querySelector(".dropdown_content"),containerCatWindow=document.querySelector(".container_category"),btnShowCat=document.querySelector(".dropbtn");btnShowCat.addEventListener("click",(function(){catWindow.classList.toggle("show")})),window.onclick=function(e){if(!e.target.matches(".dropbtn")){var t=document.querySelector(".dropdown_content");t.classList.contains("show")&&t.classList.remove("show")}};